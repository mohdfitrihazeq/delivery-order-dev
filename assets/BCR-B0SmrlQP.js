import{_ as q}from"./ReusableTable.vue_vue_type_script_setup_true_lang-BzyaffbS.js";import{g as R,r as c,v as A,_ as y,b as $,k as w,l as v,e as s,t as S,f as i,ai as N,s as B,m as k,q as _,c as g,u as U,z as h}from"./index-BWWByROH.js";import{D as F}from"./SummaryCard-BEMHh6o0.js";import{_ as T}from"./BreadcrumbList.vue_vue_type_script_setup_true_lang-CZdJiYSg.js";import{s as j}from"./index-C0HwIFuv.js";import{s as D}from"./index-CLY3q3Oj.js";import"./index-Ch6kk67X.js";import"./index-CGPca2n-.js";import"./index-CE414EAY.js";import"./index-DJe2vpyj.js";import"./index-2Hpez_V6.js";import"./index-COJ-kZaj.js";import"./index-BZdkZB22.js";import"./index-Cn_iqxZv.js";import"./index-CqvAMFTI.js";const L=R({props:{visible:{type:Boolean,required:!0},requestNo:{type:String,default:null}},emits:["update:visible","submit"],setup(e,{emit:t}){const n=c(""),l=c([]),u=A();function p(){e.requestNo&&(t("submit",e.requestNo,n.value,l.value),n.value="",l.value=[],t("update:visible",!1))}function d(){u.add({severity:"info",summary:"Success",detail:"File Uploaded",life:3e3})}return{comment:n,files:l,handleSubmit:p,onAdvancedUpload:d}}}),M={class:"font-bold"},V={class:"flex flex-col gap-3"},P={class:"flex justify-end gap-2 mt-2"};function J(e,t,n,l,u,p){const d=D,f=N,C=j,m=B,b=k;return $(),w(b,{visible:e.visible,modal:"",style:{width:"40rem"},"onUpdate:visible":t[2]||(t[2]=r=>e.$emit("update:visible",r))},{header:v(()=>[s("span",M,"Add Comments : "+S(e.requestNo),1)]),default:v(()=>[s("div",V,[t[4]||(t[4]=s("label",{class:"font-medium"},"Comment:",-1)),t[5]||(t[5]=s("span",{class:"text-gray-600 text-sm"}," Add your comment to the discussion thread for this budget change request ",-1)),i(d,{modelValue:e.comment,"onUpdate:modelValue":t[0]||(t[0]=r=>e.comment=r),rows:"4",placeholder:"Enter your comment",class:"w-full"},null,8,["modelValue"]),t[6]||(t[6]=s("label",{class:"font-medium"},"Attachments:",-1)),i(f),i(C,{name:"demo[]",url:"/api/upload",onUpload:e.onAdvancedUpload,multiple:!0,accept:"image/*",maxFileSize:1e6,class:"custom-file-upload"},{empty:v(()=>t[3]||(t[3]=[s("span",null,"Drag and drop files to here to upload.",-1)])),_:1},8,["onUpload"]),s("div",P,[i(m,{label:"Cancel",outlined:"",onClick:t[1]||(t[1]=r=>e.$emit("update:visible",!1))}),i(m,{label:"Add Comment",onClick:e.handleSubmit},null,8,["onClick"])])])]),_:1},8,["visible"])}const I=y(L,[["render",J]]),z=R({name:"BudgetChangeRequest",components:{ReusableTable:q,CommentBCR:I,Badge:_},setup(){const e=[{title:"Pending Review",value:"1",description:"Requires attention",icon:"pi pi-exclamation-triangle",color:"orange"},{title:"Under Review",value:"1",description:"Ready for review",icon:"pi pi-comment",color:"red"},{title:"Approved",value:"1",description:"Ready for implementation",icon:"pi pi-check-circle",color:"green"},{title:"Total Value",value:"$ 43,295",description:"Estimated budget impact",icon:"pi pi-chart-line",color:"blue"}],t=c([{requestNo:"BCR2024090001",projectCode:"PROJ001",requestedBy:"Jane Doe",role:"PM",dateRequested:"15/09/2024",status:"Under Review",materials:2,varianceAmount:"+$3,865",actions:["view","edit","comment"]},{requestNo:"BCR2024090002",projectCode:"PROJ001",requestedBy:"John Smith",role:"Site",dateRequested:"10/09/2024",status:"Approved",materials:1,varianceAmount:"+$4,554",actions:["view"]}]),n=c(""),l=c({}),u=c(!1),p=c(null),d=g(()=>t.value.filter(a=>(!n.value||a.requestNo.toLowerCase().includes(n.value.toLowerCase())||a.projectCode.toLowerCase().includes(n.value.toLowerCase())||a.requestedBy.toLowerCase().includes(n.value.toLowerCase()))&&(!l.value.status||a.status===l.value.status))),f=g(()=>[{field:"requestNo",header:"Request No"},{field:"projectCode",header:"Project Code"},{field:"requestedBy",header:"Requested By"},{field:"dateRequested",header:"Date Requested"},{field:"status",header:"Status",bodySlot:"status"},{field:"materials",header:"# Materials"},{field:"varianceAmount",header:"Variance Amount",bodySlot:"varianceAmount"},{field:"actions",header:"Actions",action:!0}]);function C(a){switch(a){case"Approved":return"success";case"Rejected":return"danger";case"Under Review":return"warn";default:return"info"}}const m=U();function b(a,o){a==="comment"?(p.value=o.requestNo,u.value=!0):a==="edit"?m.push(`/bcr/edit/${o.requestNo}`):m.push(`/bcr/view/${o.requestNo}`)}function r(a,o){console.log("ðŸ’¬ Comment submitted:",a,o),u.value=!1}return{requestList:t,filteredRequests:d,searchTerm:n,activeFilters:l,tableColumns:f,getStatusSeverity:C,handleActionClick:b,showCommentModal:u,selectedRequestNo:p,handleCommentSubmit:r,BudgetChangeRequestSummaryData:e}}}),E={class:"p-6 card mb-0"},O={class:"flex justify-between items-center mb-6"},x={class:"grid grid-cols-12 gap-4 mt-4 mb-16"},G={class:"font-semibold"};function H(e,t,n,l,u,p){const d=T,f=B,C=F,m=_,b=q,r=h("CommentBCR"),a=h("Motion");return $(),w(a,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8}},{default:v(()=>[s("div",E,[i(d),s("div",O,[t[2]||(t[2]=s("div",null,[s("h1",{class:"text-2xl font-bold"},"Budget Change Request"),s("p",{class:"dark:text-gray-200 text-gray-500"},"Manage budget change requests and track approval status")],-1)),i(f,{label:"+ New Change Request",onClick:t[0]||(t[0]=o=>e.$router.push("/bcr/create"))})]),s("div",x,[i(C,{cardItems:e.BudgetChangeRequestSummaryData,cardCol:4},null,8,["cardItems"])]),i(b,{value:e.filteredRequests,columns:e.tableColumns,loading:!1,showCreate:!1,showImportFile:!1,onActionClick:e.handleActionClick,onSearch:o=>e.searchTerm=o,extraFilters:e.extraFilters,onFilterChange:o=>e.activeFilters=o,emptyTitle:"No budget change requests found"},{status:v(({data:o})=>[i(m,{value:o.status,severity:e.getStatusSeverity(o.status)},null,8,["value","severity"])]),varianceAmount:v(({data:o})=>[s("span",G,S(o.varianceAmount),1)]),_:1},8,["value","columns","onActionClick","onSearch","extraFilters","onFilterChange"]),i(r,{visible:e.showCommentModal,"onUpdate:visible":t[1]||(t[1]=o=>e.showCommentModal=o),requestNo:e.selectedRequestNo,onSubmit:e.handleCommentSubmit},null,8,["visible","requestNo","onSubmit"])])]),_:1})}const ue=y(z,[["render",H]]);export{ue as default};
