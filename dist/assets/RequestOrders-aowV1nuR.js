import{_ as K}from"./BaseTab-D7yOCy_T.js";import{_ as Z}from"./ReusableTable.vue_vue_type_script_setup_true_lang-DHLeMhal.js";import{g as S,m as j,s as A,r as R,w as T,_ as I,b as B,k as q,l as p,e as l,f as o,d as $,n as de,p as P,q as U,u as re,v as ie,c as V,t as y,F as Q,x as ue,y as L,i as _,M as me,z as M,A as pe}from"./index-DtKSGrAm.js";import{_ as ce}from"./BreadcrumbList.vue_vue_type_script_setup_true_lang-Brefl-cP.js";import{s as F,a as N}from"./index-Bmzqu6cu.js";import{s as X}from"./index-jQIVVtLz.js";import{s as Y}from"./index-Bqx_AaIz.js";import{s as W}from"./index-Br23pNtW.js";import{s as x}from"./index-CK2i3JJ2.js";import"./index-DiGaO9lk.js";import"./index-DsNqXNZw.js";import"./index-By_bAaD8.js";const ve=S({name:"EditRo",components:{Dialog:j,Button:A,InputText:x,InputNumber:Y,Calendar:W,Dropdown:X,DataTable:F,Column:N},props:{visible:{type:Boolean,required:!0},order:{type:Object,default:null}},emits:["update:visible","save"],setup(e,{emit:t}){const n=R(e.visible);T(()=>e.visible,r=>{n.value=r}),T(n,r=>{t("update:visible",r)});const v=[{label:"Budgeted",value:"Budgeted"},{label:"Unbudgeted",value:"Unbudgeted"}],u=R({roNumber:"",requestedBy:"",roDate:null,deliveryDate:null,totalAmount:0,budgetType:"Budgeted",items:[]});function f(r){return r?new Date(r):null}function d(r){return r?r.toISOString().split("T")[0]:""}T(()=>e.order,r=>{r&&(u.value={roNumber:r.roNumber,requestedBy:r.requestedBy,roDate:f(r.roDate),deliveryDate:f(r.deliveryDate),totalAmount:Number(r.totalAmount),budgetType:r.budgetType,items:r.items.map(i=>({...i,deliveryDate:f(i.deliveryDate)}))})},{immediate:!0});function b(){const r={roNumber:u.value.roNumber,requestedBy:u.value.requestedBy,roDate:d(u.value.roDate),deliveryDate:d(u.value.deliveryDate),totalAmount:u.value.totalAmount,budgetType:u.value.budgetType,items:u.value.items.map(i=>({...i,deliveryDate:d(i.deliveryDate)}))};t("save",r),n.value=!1}function m(){e.order&&(u.value={roNumber:e.order.roNumber,requestedBy:e.order.requestedBy,roDate:f(e.order.roDate),deliveryDate:f(e.order.deliveryDate),totalAmount:Number(e.order.totalAmount),budgetType:e.order.budgetType,items:e.order.items.map(r=>({...r,deliveryDate:f(r.deliveryDate)}))}),n.value=!1}function D(){u.value.items.push({code:"",description:"",uom:"",qty:0,deliveryDate:null,note:""})}function C(r){u.value.items.splice(r,1)}return{localVisible:n,editForm:u,budgetTypeOptions:v,handleSave:b,handleCancel:m,addItem:D,removeItem:C}}}),be={key:0},fe={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6"},ye={class:"border rounded-lg overflow-hidden mb-4"},ge={class:"flex justify-end gap-2"};function he(e,t,n,v,u,f){const d=x,b=W,m=Y,D=X,C=N,r=A,i=F,c=j;return B(),q(c,{visible:e.localVisible,"onUpdate:visible":t[7]||(t[7]=a=>e.localVisible=a),modal:!0,header:"Edit Request Order",class:"w-11/12 md:w-2/3"},{footer:p(()=>[l("div",ge,[o(r,{label:"Cancel",severity:"secondary",outlined:"",icon:"pi pi-times",onClick:e.handleCancel},null,8,["onClick"]),o(r,{label:"Save Changes",severity:"success",icon:"pi pi-check",onClick:e.handleSave},null,8,["onClick"])])]),default:p(()=>[e.order?(B(),$("div",be,[l("form",{onSubmit:t[6]||(t[6]=de((...a)=>e.handleSave&&e.handleSave(...a),["prevent"]))},[l("div",fe,[l("div",null,[t[8]||(t[8]=l("label",{class:"block text-sm font-semibold mb-2"},"RO Number",-1)),o(d,{modelValue:e.editForm.roNumber,"onUpdate:modelValue":t[0]||(t[0]=a=>e.editForm.roNumber=a),class:"w-full",disabled:""},null,8,["modelValue"])]),l("div",null,[t[9]||(t[9]=l("label",{class:"block text-sm font-semibold mb-2"},"Requested By",-1)),o(d,{modelValue:e.editForm.requestedBy,"onUpdate:modelValue":t[1]||(t[1]=a=>e.editForm.requestedBy=a),class:"w-full"},null,8,["modelValue"])]),l("div",null,[t[10]||(t[10]=l("label",{class:"block text-sm font-semibold mb-2"},"RO Date",-1)),o(b,{modelValue:e.editForm.roDate,"onUpdate:modelValue":t[2]||(t[2]=a=>e.editForm.roDate=a),dateFormat:"yy-mm-dd",class:"w-full"},null,8,["modelValue"])]),l("div",null,[t[11]||(t[11]=l("label",{class:"block text-sm font-semibold mb-2"},"Delivery Date",-1)),o(b,{modelValue:e.editForm.deliveryDate,"onUpdate:modelValue":t[3]||(t[3]=a=>e.editForm.deliveryDate=a),dateFormat:"yy-mm-dd",class:"w-full"},null,8,["modelValue"])]),l("div",null,[t[12]||(t[12]=l("label",{class:"block text-sm font-semibold mb-2"},"Total Amount",-1)),o(m,{modelValue:e.editForm.totalAmount,"onUpdate:modelValue":t[4]||(t[4]=a=>e.editForm.totalAmount=a),mode:"decimal",minFractionDigits:2,class:"w-full"},null,8,["modelValue"])]),l("div",null,[t[13]||(t[13]=l("label",{class:"block text-sm font-semibold mb-2"},"Budget Type",-1)),o(D,{modelValue:e.editForm.budgetType,"onUpdate:modelValue":t[5]||(t[5]=a=>e.editForm.budgetType=a),options:e.budgetTypeOptions,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue","options"])])]),t[14]||(t[14]=l("h3",{class:"font-semibold mb-3"},"Requested Items",-1)),l("div",ye,[o(i,{value:e.editForm.items,class:"w-full"},{default:p(()=>[o(C,{field:"code",header:"Item Code"},{body:p(a=>[o(d,{modelValue:a.data.code,"onUpdate:modelValue":g=>a.data.code=g,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(C,{field:"description",header:"Description"},{body:p(a=>[o(d,{modelValue:a.data.description,"onUpdate:modelValue":g=>a.data.description=g,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(C,{field:"uom",header:"UOM"},{body:p(a=>[o(d,{modelValue:a.data.uom,"onUpdate:modelValue":g=>a.data.uom=g,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(C,{field:"qty",header:"Quantity"},{body:p(a=>[o(m,{modelValue:a.data.qty,"onUpdate:modelValue":g=>a.data.qty=g,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(C,{field:"deliveryDate",header:"Delivery Date"},{body:p(a=>[o(b,{modelValue:a.data.deliveryDate,"onUpdate:modelValue":g=>a.data.deliveryDate=g,dateFormat:"yy-mm-dd",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(C,{field:"note",header:"Note"},{body:p(a=>[o(d,{modelValue:a.data.note,"onUpdate:modelValue":g=>a.data.note=g,class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(C,{header:"Actions"},{body:p(a=>[o(r,{icon:"pi pi-trash",severity:"danger",text:"",onClick:g=>e.removeItem(a.index)},null,8,["onClick"])]),_:1})]),_:1},8,["value"])]),o(r,{label:"Add Item",icon:"pi pi-plus",outlined:"",onClick:e.addItem,class:"mb-4"},null,8,["onClick"])],32)])):P("",!0)]),_:1},8,["visible"])}const De=I(ve,[["render",he]]),Ce=S({name:"ViewDraftRo",components:{Dialog:j,Button:A,DataTable:F,Column:N,InputText:x,Badge:U},props:{visible:{type:Boolean,required:!0}},emits:["update:visible"],setup(e,{emit:t}){const n=re(),v=ie(),u=R(""),f=R(e.visible),d=R([{draftId:"DRAFT-RO-240901-001",project:"MKT",budgetType:"Budgeted",requestedBy:"John Smith",itemsCount:2,lastModified:"2024-09-01",roNumber:"RO2025208757",roDate:"2024-09-01",items:[{itemCode:"STL-01",description:"Steel reinforcement bar 60mm",location:"Building A > Level 1-5",uom:"Ton",quantity:"25",price:550,deliveryDate:null,notes:"",remark:""},{itemCode:"CEM-02",description:"Cement Portland Type I",location:"Building B > Level 1-8",uom:"Bag",quantity:"180",price:250,deliveryDate:null,notes:"",remark:""}],overallRemark:"Urgent materials needed for Phase 1"},{draftId:"DRAFT-RO-240902-001",project:"MKT",budgetType:"Unbudgeted",requestedBy:"Maria Garcia",itemsCount:1,lastModified:"2024-09-03",roNumber:"RO2025208758",roDate:"2024-09-02",items:[{itemCode:"STL-01",description:"Steel reinforcement bar 60mm",location:"Building A > Level 1-5",uom:"Ton",quantity:"10",price:550,deliveryDate:null,notes:"",remark:""}],overallRemark:""},{draftId:"DRAFT-RO-20250929-321",project:"MKT",budgetType:"Budgeted",requestedBy:"Jane Doe",itemsCount:1,lastModified:"2025-09-29",roNumber:"RO2025208759",roDate:"2025-09-29",items:[{itemCode:"CEM-02",description:"Cement Portland Type I",location:"Building B > Level 1-8",uom:"Bag",quantity:"50",price:250,deliveryDate:null,notes:"",remark:""}],overallRemark:"For foundation work"}]),b=V(()=>{if(!u.value.trim())return d.value;const c=u.value.toLowerCase();return d.value.filter(a=>a.draftId.toLowerCase().includes(c)||a.requestedBy.toLowerCase().includes(c)||a.project.toLowerCase().includes(c)||a.budgetType.toLowerCase().includes(c))}),m=V(()=>d.value.length);T(()=>d.value.length,c=>{t("update:count",c)},{immediate:!0}),T(()=>e.visible,c=>{f.value=c}),T(f,c=>{t("update:visible",c)});function D(){f.value=!1}function C(c){n.push({path:"/request-orders/create",query:{draftId:c.draftId,mode:"edit-draft"},state:{draftData:c}}),v.add({severity:"info",summary:"Draft Loaded",detail:`Continuing draft ${c.draftId}`,life:3e3}),D()}function r(c){const a=d.value.findIndex(g=>g.draftId===c.draftId);a!==-1&&(d.value.splice(a,1),v.add({severity:"success",summary:"Draft Deleted",detail:`Draft ${c.draftId} has been deleted`,life:3e3}))}function i(c){return new Date(c).toLocaleDateString("en-US",{month:"numeric",day:"numeric",year:"numeric"})}return{searchQuery:u,drafts:d,filteredDrafts:b,handleClose:D,handleContinue:C,handleDelete:r,formatDate:i,localVisible:f,draftCount:m}}}),we={class:"mb-4"},ke={class:"p-input-icon-left w-full"},Re={class:"font-medium"},Be={class:"flex items-center justify-center gap-1"},Ve={class:"flex items-center gap-1"},Te={class:"flex gap-2"},qe={class:"flex justify-end"};function Ae(e,t,n,v,u,f){const d=x,b=N,m=U,D=A,C=F,r=j;return B(),q(r,{visible:e.localVisible,"onUpdate:visible":[t[1]||(t[1]=i=>e.localVisible=i),e.handleClose],modal:"",header:"Draft Request Orders",class:"w-11/12 md:w-5/6"},{footer:p(()=>[l("div",qe,[o(D,{label:"Close",severity:"secondary",outlined:"",icon:"pi pi-times",onClick:e.handleClose},null,8,["onClick"])])]),default:p(()=>[t[4]||(t[4]=l("div",{class:"mb-4"},[l("p",{class:"text-gray-600"},"Continue editing saved draft request orders or delete unused drafts.")],-1)),l("div",we,[l("span",ke,[o(d,{modelValue:e.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=i=>e.searchQuery=i),placeholder:"Search by draft ID, requester, project, or budget type...",class:"w-full"},null,8,["modelValue"])])]),o(C,{value:e.filteredDrafts,paginator:e.filteredDrafts.length>5,rows:5,class:"mb-4",emptyMessage:"No draft request orders found"},{default:p(()=>[o(b,{field:"draftId",header:"Draft ID",sortable:"",style:{"min-width":"180px"}},{body:p(({data:i})=>[l("span",Re,y(i.draftId),1)]),_:1}),o(b,{field:"project",header:"Project",sortable:"",style:{"min-width":"100px"}},{body:p(({data:i})=>[l("span",null,y(i.project),1)]),_:1}),o(b,{field:"budgetType",header:"Budget Type",sortable:"",style:{"min-width":"130px"}},{body:p(({data:i})=>[o(m,{value:i.budgetType,severity:i.budgetType==="Budgeted"?"success":"warning"},null,8,["value","severity"])]),_:1}),o(b,{field:"requestedBy",header:"Requested By",sortable:"",style:{"min-width":"140px"}},{body:p(({data:i})=>[l("span",null,y(i.requestedBy),1)]),_:1}),o(b,{field:"itemsCount",header:"Items",style:{"min-width":"80px","text-align":"center"}},{body:p(({data:i})=>[l("div",Be,[t[2]||(t[2]=l("i",{class:"pi pi-box text-gray-500"},null,-1)),l("span",null,y(i.itemsCount),1)])]),_:1}),o(b,{field:"lastModified",header:"Last Modified",sortable:"",style:{"min-width":"140px"}},{body:p(({data:i})=>[l("div",Ve,[t[3]||(t[3]=l("i",{class:"pi pi-calendar text-gray-500"},null,-1)),l("span",null,y(e.formatDate(i.lastModified)),1)])]),_:1}),o(b,{header:"Actions",style:{"min-width":"180px"}},{body:p(({data:i})=>[l("div",Te,[o(D,{label:"Continue",icon:"pi pi-pencil",size:"small",outlined:"",onClick:c=>e.handleContinue(i)},null,8,["onClick"]),o(D,{icon:"pi pi-trash",severity:"danger",size:"small",outlined:"",onClick:c=>e.handleDelete(i)},null,8,["onClick"])])]),_:1})]),_:1},8,["value","paginator"])]),_:1},8,["visible","onUpdate:visible"])}const $e=I(Ce,[["render",Ae]]),je=S({name:"ViewRo",components:{Dialog:j,Button:A},props:{visible:{type:Boolean,required:!0},order:{type:Object,default:null},isPurchasingRole:{type:Boolean,default:!1}},emits:["update:visible","approve","reject"],setup(e,{emit:t}){const n=R(e.visible);T(()=>e.visible,d=>{n.value=d}),T(n,d=>{t("update:visible",d)});function v(){n.value=!1}function u(){t("approve",e.order),n.value=!1}function f(){t("reject",e.order),n.value=!1}return{localVisible:n,handleClose:v,handleApprove:u,handleReject:f}}}),Me={key:0},Oe={class:"text-lg font-bold mb-4"},Se={class:"grid grid-cols-2 gap-4 text-sm mb-6"},Ie={class:"w-full border text-sm"},Ue={class:"p-2"},Fe={class:"p-2"},Ne={class:"p-2"},xe={class:"p-2"},_e={class:"p-2"},Le={class:"p-2"},Pe={class:"flex justify-end gap-2"};function Ee(e,t,n,v,u,f){const d=A,b=j;return B(),q(b,{visible:e.localVisible,"onUpdate:visible":t[0]||(t[0]=m=>e.localVisible=m),modal:"",header:"Request Order Details",class:"w-11/12 md:w-2/3"},{footer:p(()=>{var m;return[l("div",Pe,[e.isPurchasingRole&&((m=e.order)==null?void 0:m.status)==="Pending"?(B(),$(Q,{key:0},[o(d,{label:"Reject Request",severity:"danger",outlined:"",icon:"pi pi-times",onClick:e.handleReject},null,8,["onClick"]),o(d,{label:"Approve Request",severity:"success",icon:"pi pi-check",onClick:e.handleApprove},null,8,["onClick"])],64)):(B(),q(d,{key:1,label:"Close",severity:"secondary",icon:"pi pi-times",onClick:e.handleClose},null,8,["onClick"]))])]}),default:p(()=>[e.order?(B(),$("div",Me,[l("h2",Oe,"Request Order - "+y(e.order.roNumber),1),l("div",Se,[l("div",null,[t[1]||(t[1]=l("p",{class:"font-semibold"},"Status",-1)),l("p",null,y(e.order.status),1)]),l("div",null,[t[2]||(t[2]=l("p",{class:"font-semibold"},"Requested At",-1)),l("p",null,y(e.order.requestedAt),1)]),l("div",null,[t[3]||(t[3]=l("p",{class:"font-semibold"},"Requested By",-1)),l("p",null,y(e.order.requestedBy),1)]),l("div",null,[t[4]||(t[4]=l("p",{class:"font-semibold"},"Budget Type",-1)),l("p",null,y(e.order.budgetType),1)]),l("div",null,[t[5]||(t[5]=l("p",{class:"font-semibold"},"RO Date",-1)),l("p",null,y(e.order.roDate),1)])]),t[7]||(t[7]=l("h3",{class:"font-semibold mb-2"},"Requested Items",-1)),l("table",Ie,[t[6]||(t[6]=l("thead",null,[l("tr",{class:"bg-gray-100"},[l("th",{class:"p-2 text-left"},"Item Code"),l("th",{class:"p-2 text-left"},"Description"),l("th",{class:"p-2 text-left"},"UOM"),l("th",{class:"p-2 text-left"},"Order Qty"),l("th",{class:"p-2 text-left"},"Delivery Date"),l("th",{class:"p-2 text-left"},"Note")])],-1)),l("tbody",null,[(B(!0),$(Q,null,ue(e.order.items,(m,D)=>(B(),$("tr",{key:D},[l("td",Ue,y(m.code),1),l("td",Fe,y(m.description),1),l("td",Ne,y(m.uom),1),l("td",xe,y(m.qty),1),l("td",_e,y(m.deliveryDate),1),l("td",Le,y(m.note),1)]))),128))])])])):P("",!0)]),_:1},8,["visible"])}const ze=I(je,[["render",Ee]]);/**
 * @license lucide-vue-next v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Je=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,v)=>v?v.toUpperCase():n.toLowerCase()),Qe=e=>{const t=Je(e);return t.charAt(0).toUpperCase()+t.slice(1)},He=(...e)=>e.filter((t,n,v)=>!!t&&t.trim()!==""&&v.indexOf(t)===n).join(" ").trim(),G=e=>e==="";/**
 * @license lucide-vue-next v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var O={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};/**
 * @license lucide-vue-next v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=({name:e,iconNode:t,absoluteStrokeWidth:n,"absolute-stroke-width":v,strokeWidth:u,"stroke-width":f,size:d=O.width,color:b=O.stroke,...m},{slots:D})=>L("svg",{...O,...m,width:d,height:d,stroke:b,"stroke-width":G(n)||G(v)||n===!0||v===!0?Number(u||f||O["stroke-width"])*24/Number(d):u||f||O["stroke-width"],class:He("lucide",m.class,...e?[`lucide-${H(Qe(e))}-icon`,`lucide-${H(e)}`]:["lucide-icon"])},[...t.map(C=>L(...C)),...D.default?[D.default()]:[]]);/**
 * @license lucide-vue-next v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=(e,t)=>(n,{slots:v,attrs:u})=>L(Ge,{...u,...n,iconNode:t,name:e},v);/**
 * @license lucide-vue-next v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=E("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-vue-next v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=E("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-vue-next v0.543.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=E("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Ye={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"},We={class:"flex justify-between items-center p-6 bg-white dark:bg-gray-400/10 rounded-2xl shadow-sm border"},et={class:"text-2xl font-bold text-yellow-600 mt-2"},tt={class:"flex justify-between items-center p-6 bg-white dark:bg-gray-400/10 rounded-2xl shadow-sm border"},lt={class:"text-2xl font-bold text-green-600 mt-2"},ot={class:"flex justify-between items-center p-6 bg-white dark:bg-gray-400/10 rounded-2xl shadow-sm border"},at={class:"text-2xl font-bold text-gray-800 dark:text-white mt-2"},st=S({__name:"RoSummary",props:{pendingCount:{},approvedCount:{},totalValue:{}},setup(e){return(t,n)=>(B(),$("div",Ye,[l("div",We,[l("div",null,[n[0]||(n[0]=l("h3",{class:"font-semibold text-gray-800 dark:text-white"},"Pending Orders",-1)),l("p",et,y(t.pendingCount),1),n[1]||(n[1]=l("p",{class:"dark:text-white text-gray-500 text-sm"},"Awaiting approval",-1))]),o(_(Xe),{class:"w-6 h-6 text-yellow-600"})]),l("div",tt,[l("div",null,[n[2]||(n[2]=l("h3",{class:"font-semibold text-gray-800 dark:text-white"},"Approved This Week",-1)),l("p",lt,y(t.approvedCount),1),n[3]||(n[3]=l("p",{class:"dark:text-white text-gray-500 text-sm"},"Approved for purchase",-1))]),o(_(Ke),{class:"w-6 h-6 text-green-600"})]),l("div",ot,[l("div",null,[n[4]||(n[4]=l("h3",{class:"font-semibold text-gray-800 dark:text-white"},"Total Request Order Value",-1)),l("p",at,"$"+y(t.totalValue),1),n[5]||(n[5]=l("p",{class:"dark:text-white text-gray-500 text-sm"},"Total orders value",-1))]),o(_(Ze),{class:"dark:text-white w-6 h-6 text-gray-500"})])]))}}),nt=S({name:"RequestOrders",components:{BaseTab:K,Motion:me,ReusableTable:Z,RoSummary:st,ViewRo:ze,EditRo:De,Badge:U,ViewDraftRo:$e},setup(){const e=R(0),t=R(!1),n=localStorage.getItem("user");let v="";if(n)try{v=JSON.parse(n).role||""}catch{v=""}const u=v.toLowerCase()==="purchasing",f=R(u?"pending":"all"),d=R([{id:1,roNumber:"RO-001",requestedBy:"John Doe",roDate:"2025-09-01",deliveryDate:"2025-09-05",totalAmount:"1200",budgetType:"Budgeted",status:"Approved",requestedAt:"2025-08-30",items:[{code:"STL-001",description:"Steel reinforcement bars",uom:"kg",qty:100,deliveryDate:"2025-09-05",note:"Grade 60 steel"}]},{id:2,roNumber:"RO-002",requestedBy:"Jane Smith",roDate:"2025-09-02",deliveryDate:"2025-09-06",totalAmount:"500",budgetType:"Unbudgeted",status:"Pending",requestedAt:"2025-08-31",items:[{code:"CEM-002",description:"Cement Portland Type I",uom:"Bag",qty:50,deliveryDate:"2025-09-06",note:"High quality cement"}]},{id:3,roNumber:"RO-003",requestedBy:"Michael Tan",roDate:"2025-09-03",deliveryDate:"2025-09-07",totalAmount:"750",budgetType:"Budgeted",status:"Rejected",requestedAt:"2025-09-01",items:[{code:"LAB-001",description:"Excavation work",uom:"m³",qty:25,deliveryDate:"2025-09-07",note:"Manual excavation"}]}]),b=V(()=>{const s=[{field:"roNumber",header:"RO Number",sortable:!0},{field:"requestedBy",header:"Requested By",sortable:!0},{field:"roDate",header:"RO Date",sortable:!0},{field:"deliveryDate",header:"Delivery Date",sortable:!0},{field:"totalAmount",header:"Total Amount",sortable:!0,bodySlot:"totalAmount"},{field:"budgetType",header:"Budget Type",sortable:!0,bodySlot:"budgetType"},{field:"status",header:"Status",sortable:!0,bodySlot:"status"}],k={field:"actions",header:"Actions",action:!0,actions:["view","edit"]};return[...s,k]}),m=V(()=>[{type:"select",field:"status",placeholder:"Filter by Status",options:[{label:"All Statuses",value:""},{label:"Pending",value:"Pending"},{label:"Approved",value:"Approved"},{label:"Rejected",value:"Rejected"}]},{type:"select",field:"budgetType",placeholder:"Filter by Budget Type",options:[{label:"All Budget Types",value:""},{label:"Budgeted",value:"Budgeted"},{label:"Unbudgeted",value:"Unbudgeted"}]}]),D=V(()=>u?[{label:"Pending",value:"pending",badge:r.value},{label:"All Orders",value:"all"},{label:"Approved",value:"approved"},{label:"Rejected",value:"rejected"}]:[{label:"All Orders",value:"all"},{label:"Approved",value:"approved"},{label:"Rejected",value:"rejected"}]),C=V(()=>{switch(f.value){case"pending":return d.value.filter(s=>s.status==="Pending");case"approved":return d.value.filter(s=>s.status==="Approved");case"rejected":return d.value.filter(s=>s.status==="Rejected");case"all":default:return d.value}}),r=V(()=>d.value.filter(s=>s.status==="Pending").length),i=V(()=>d.value.filter(s=>s.status==="Approved").length),c=V(()=>d.value.reduce((s,k)=>s+Number(k.totalAmount||0),0));function a(s){switch(s){case"Approved":return"success";case"Rejected":return"danger";case"Pending":return"warning";default:return"info"}}const g=R(!1),w=R(!1),h=R(null);function z(s){h.value=s,g.value=!0}function ee(s){const k=s||h.value;k&&(k.status="Approved"),g.value=!1}function te(s){const k=s||h.value;k&&(k.status="Rejected"),g.value=!1}function J(s){h.value=s,w.value=!0}function le(s){h.value&&(h.value.requestedBy=s.requestedBy,h.value.roDate=s.roDate,h.value.deliveryDate=s.deliveryDate,h.value.totalAmount=s.totalAmount.toString(),h.value.budgetType=s.budgetType,h.value.items=[...s.items],console.log("Order saved:",h.value))}function oe(s){s&&(s.status="Approved",console.log("Order approved:",s.roNumber))}function ae(s){s&&(s.status="Rejected",console.log("Order rejected:",s.roNumber))}function se(s,k){switch(console.log("Action clicked:",s,"Row data:",k),s){case"view":z(k);break;case"edit":J(k);break;default:console.log("Unknown action type:",s);break}}function ne(s){console.log("Filters applied:",s)}return{activeTab:f,tabItems:D,orders:d,filteredOrders:C,getStatusSeverity:a,pendingCount:r,approvedCount:i,totalValue:c,isPurchasingRole:u,showDetailsModal:g,showEditModal:w,selectedOrder:h,openOrderDetails:z,approveOrder:ee,rejectOrder:te,editOrder:J,handleSaveOrder:le,handleApproveFromModal:oe,handleRejectFromModal:ae,tableColumns:b,tableFilters:m,handleActionClick:se,handleFilterChange:ne,open,close,showDraftModal:t,draftCount:e}}}),dt={class:"p-6 card glossy-card mb-0"},rt={class:"flex justify-between items-center mb-6"},it={class:"flex gap-6"},ut={class:"relative inline-block"},mt={class:"card"},pt={class:"font-semibold"};function ct(e,t,n,v,u,f){const d=ce,b=A,m=U,D=M("ViewDraftRo"),C=M("RoSummary"),r=Z,i=M("Motion"),c=K,a=M("ViewRo"),g=M("EditRo");return B(),q(i,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.8}},{default:p(()=>[l("div",dt,[o(d),l("div",rt,[t[7]||(t[7]=l("div",null,[l("h1",{class:"text-2xl font-bold"},"Request Orders"),l("p",{class:"dark:text-gray-200 text-gray-500"},"Manage purchase requests for project materials and services")],-1)),l("div",it,[l("div",ut,[o(b,{label:"View Drafts",outlined:"",onClick:t[0]||(t[0]=w=>e.showDraftModal=!0),class:"pr-8"}),e.draftCount>0?(B(),q(m,{key:0,value:e.draftCount,severity:"danger",class:"absolute top-0 right-0 transform translate-x-1/2 -translate-y-1/2"},null,8,["value"])):P("",!0)]),o(b,{label:"+ New Request Order",onClick:t[1]||(t[1]=w=>e.$router.push("/request-orders/create"))})])]),o(D,{visible:e.showDraftModal,"onUpdate:visible":t[2]||(t[2]=w=>e.showDraftModal=w),"onUpdate:count":t[3]||(t[3]=w=>e.draftCount=w)},null,8,["visible"]),o(C,{pendingCount:e.pendingCount,approvedCount:e.approvedCount,totalValue:e.totalValue},null,8,["pendingCount","approvedCount","totalValue"]),l("div",mt,[o(c,{modelValue:e.activeTab,"onUpdate:modelValue":t[4]||(t[4]=w=>e.activeTab=w),tabs:e.tabItems},{default:p(({activeTab:w})=>[(B(),q(i,{key:w,initial:{opacity:0,x:30},animate:{opacity:1,x:0},exit:{opacity:0,x:-30},transition:{duration:.8}},{default:p(()=>[o(r,{value:e.filteredOrders,columns:e.tableColumns,loading:!1,showCreate:!1,showImportFile:!1,onActionClick:e.handleActionClick,extraFilters:e.tableFilters,onFilterChange:e.handleFilterChange,emptyTitle:"No request orders found"},{status:p(({data:h})=>[o(m,{value:h.status,severity:e.getStatusSeverity(h.status)},null,8,["value","severity"])]),budgetType:p(({data:h})=>[l("span",{class:pe(["px-2 py-1 rounded text-xs",h.budgetType==="Budgeted"?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"])},y(h.budgetType),3)]),totalAmount:p(({data:h})=>[l("span",pt,"RM "+y(Number(h.totalAmount).toLocaleString()),1)]),_:1},8,["value","columns","onActionClick","extraFilters","onFilterChange"])]),_:2},1024))]),_:1},8,["modelValue","tabs"])]),o(a,{visible:e.showDetailsModal,"onUpdate:visible":t[5]||(t[5]=w=>e.showDetailsModal=w),order:e.selectedOrder,isPurchasingRole:e.isPurchasingRole,onApprove:e.handleApproveFromModal,onReject:e.handleRejectFromModal},null,8,["visible","order","isPurchasingRole","onApprove","onReject"]),o(g,{visible:e.showEditModal,"onUpdate:visible":t[6]||(t[6]=w=>e.showEditModal=w),order:e.selectedOrder,onSave:e.handleSaveOrder},null,8,["visible","order","onSave"])])]),_:1})}const Vt=I(nt,[["render",ct]]);export{Vt as default};
